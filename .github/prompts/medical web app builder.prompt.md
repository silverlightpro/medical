---
mode: agent
---
You are a world-class, full-stack software development team, composed of an expert backend engineer, a senior frontend engineer, a database architect, and a UI/UX designer. Your task is to build a secure, robust, and user-friendly full-stack web application called "VA Claim Assistant".
This application will be a complete rewrite and enhancement of a previous prototype. It must be built with a modern technology stack, feature a secure backend API, persist all user data in a database, and include comprehensive user authentication.
I. Core Architecture & Technology Stack
Backend: Node.js with the Express.js framework.
Frontend: React.js, using Vite for the build tool. The existing UI components should be adapted to fetch and send data via the backend API.
Database: SQLite. You must use the Prisma ORM for all database interactions, including schema definition, migrations, and queries. This ensures type safety and simplifies database management.
Styling: Tailwind CSS for a utility-first approach to styling, ensuring a responsive and modern design.
API Communication: The frontend and backend must communicate exclusively through a well-defined RESTful API. All sensitive operations, including database queries and calls to the Gemini API, must be performed on the backend.
II. User Authentication & Data Persistence
You must implement a complete user authentication system and database schema to securely store user-specific data.
Database Schema (Prisma)
Define a schema.prisma file with at least the following models:
User:
id (unique identifier)
email (unique, used for login)
passwordHash (string, for storing the hashed password)
firstName, lastName
createdAt, updatedAt
Relations: Has many Claims, Documents.
Claim:
id (unique identifier)
userId (foreign key to User)
status (e.g., 'Draft', 'Analysis Complete', 'Submitted')
caseDescription (text submitted by the user)
claimSetupData (JSON, for storing role, patient name, etc.)
analysisQuestions (JSON, questions generated by AI)
userAnswers (JSON, user's answers to questions)
potentialClaimEvents (JSON, AI-identified claims)
selectedClaims (JSON, claims selected by the user with comments)
finalDocument (JSON, the final generated statement and summaries)
vaFormData (JSON, data for the final VA form)
createdAt, updatedAt
Relations: Belongs to one User, has many Documents.
Document:
id (unique identifier)
userId (foreign key to User)
claimId (optional foreign key to Claim)
fileName (string)
storagePath (string, path to the file on the server's file system)
extractedText (long text, for the parsed content of the PDF)
createdAt
Relations: Belongs to one User, optionally belongs to one Claim.
Authentication Flow:
Registration: New users can sign up with a first name, last name, email, and password. Passwords must be hashed using bcrypt before being stored in the User table.
Login: Registered users can log in with their email and password. Upon successful authentication, the backend generates a JSON Web Token (JWT) and sends it to the client.
Session Management: The frontend must store the JWT securely (e.g., in an HttpOnly cookie) and include it in the authorization header for all subsequent API requests.
Protected Routes: All API endpoints that handle user data must be protected, requiring a valid JWT for access. The backend will verify the token and fetch data only for the authenticated user.
III. Core Feature Implementation
Re-implement all features from the original prototype, adapting them to the new client-server architecture.
Dashboard: After login, the user sees a dashboard. This page should fetch and display a list of their "In-Progress Claims" from the /api/claims endpoint. Each claim in the list should be clickable, taking the user to its current stage in the process.
Guided Claim Checklist: This remains a key feature. While the content can initially be static as in the prototype, it should be served from the backend via an API endpoint (e.g., /api/checklists/urgent-1151). This allows for future updates without deploying new frontend code.
AI-Powered Claim Analysis Flow: This multi-step process is the core of the application. All state must be persisted in the database at each step, associated with a Claim record. All Gemini API calls must originate from the secure backend.
Step 1: Start New Claim: A user action that creates a new Claim record in the database with a status of 'Draft'.
Step 2: Case Submission: The user uploads PDF files and provides a text description.
Backend: The backend receives the files, saves them to a secure location on the server, and stores their paths and metadata in the Document table. It then uses a library like pdf-parse to extract text from the PDFs, saving the text to the Document record. The user's text description is saved to the Claim record.
Step 3: Claim Setup: The user provides the Veteran's name, their relationship, etc. This data is saved to the claimSetupData field on the Claim record.
Step 4-8 (AI Interaction): Each of the following steps involves the frontend sending a request to a dedicated backend endpoint (e.g., POST /api/claims/:id/generate-questions). The backend retrieves the necessary data from the database, makes the call to the Gemini API (using the appropriate model, schema, and system instructions as defined in the prototype), and saves the result back to the correct field in the Claim record before sending it to the frontend for display. This applies to:
Generating analysis questions.
Identifying potential claim events.
Generating the final lay statement and summaries.
Extracting data for the VA form pre-fill.
Final Form Preview & Download: The final preview component should be rendered using data from the vaFormData field of the Claim record. The download/print functionality remains the same.
IV. New and Enhanced Features
Implement the following new features to improve the application's utility and user experience.
Secure Document Vault:
Create a dedicated "My Documents" page where users can upload, view, and manage all their files (medical records, letters, etc.), even those not yet associated with a specific claim.
Allow users to associate uploaded documents with a new or existing claim.
Claim Status & History:
On the dashboard, display the status of each claim clearly (e.g., "Awaiting Analysis", "Reviewing Potential Claims", "Final Document Ready").
Allow users to manually update the status of claims after they have been submitted to the VA (e.g., "Submitted", "C&P Exam Scheduled", "Decision Received").
Allow users to archive or delete old claims.
Email Notifications:
Integrate an email service (e.g., Nodemailer with a service like SendGrid) to send transactional emails.
Send notifications for key events:
Welcome email upon registration.
"Your AI analysis is complete and ready for review."
"Your final claim document has been generated."
Enhanced Security & Privacy:
All user input must be sanitized and validated on the backend to prevent XSS and other injection attacks.
Implement rate limiting on the API to prevent abuse.
Clearly state the app's privacy policy and how user data is handled.
Ensure all data, especially PII and PHI, is handled securely and is only accessible by the authenticated user who owns it.
V. Non-Functional Requirements
UI/UX: The application must be visually appealing, intuitive, and easy to navigate. It must be fully responsive and work seamlessly on desktop, tablet, and mobile devices.
Accessibility: Adhere to WCAG 2.1 AA standards. Use semantic HTML and ARIA attributes where necessary.
Performance: Optimize API response times and frontend rendering. Use loading indicators (SpinnerIcon) for all asynchronous operations to provide user feedback.
Error Handling: Implement robust error handling on both the frontend and backend. Display user-friendly error messages when API calls fail or unexpected issues occur.
